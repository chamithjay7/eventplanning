<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>New User - PG113</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="/js/app.js"></script>
</head>
<body class="container py-5">
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4">Create User</h1>
    <div class="d-flex gap-2">
        <a href="/users/list.html" class="btn btn-outline-secondary">Back</a>
        <button id="logoutBtn" class="btn btn-danger">Logout</button>
    </div>
</div>

<div id="msg"></div>

<form id="form" class="col-md-5">
    <div class="mb-3">
        <label class="form-label">Username</label>
        <input id="username" class="form-control" required maxlength="50">
    </div>
    <div class="mb-3">
        <label class="form-label">Email</label>
        <input id="email" type="email" class="form-control" required maxlength="100">
    </div>
    <div class="mb-3">
        <label class="form-label">Password</label>
        <input id="password" type="password" class="form-control" required minlength="6" maxlength="255">
    </div>
    <div class="mb-3">
        <label class="form-label">Role</label>
        <select id="role" class="form-select">
            <option>USER</option>
            <option>ORGANIZER</option>
            <option>VENDOR</option>
            <option>ADMIN</option>
        </select>
    </div>
    <button class="btn btn-success">Create</button>
</form>

<script>
    function toast(type, text) {
        document.getElementById("msg").innerHTML =
            `<div class="alert alert-${type}">${text}</div>`;
        setTimeout(()=> document.getElementById("msg").innerHTML = "", 2500);
    }

    document.getElementById("logoutBtn").addEventListener("click", () => {
        clearToken(); window.location.href = "/login.html";
    });

    document.getElementById("form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const body = {
            username: document.getElementById("username").value.trim(),
            email: document.getElementById("email").value.trim(),
            password: document.getElementById("password").value,
            role: document.getElementById("role").value
        };
        try {
            await apiRequest("/api/users", { method: "POST", body: JSON.stringify(body) });
            toast("success", "User created");
            setTimeout(()=> window.location.href = "/users/list.html", 600);
        } catch (err) {
            toast("danger", "Create failed (need ADMIN or validation error)");
        }
    });
</script>
</body>
</html>
